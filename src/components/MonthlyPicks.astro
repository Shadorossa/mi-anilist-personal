---
const { picks } = Astro.props;
// Invertir orden (m치s nuevo arriba)
const sortedPicks = [...picks].reverse(); // Asume que picks viene ordenado cronol칩gicamente, si no, revierte el orden de inserci칩n.
---

<section>
    <div class="flex items-center justify-between mb-6">
        <h2
            class="text-xl font-bold text-white flex items-center gap-3 opacity-90"
        >
            <i class="fa-regular fa-calendar-check text-indigo-500"></i> Favorito
            del Mes
        </h2>
    </div>

    <div
        id="monthly-container"
        class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 transition-all duration-500 overflow-hidden max-h-[160px] relative"
    >
        {
            sortedPicks.map((pick) => (
                <div class="bg-[#121215] border border-white/5 rounded-xl p-2 flex items-center gap-3 group hover:bg-white/5 transition-colors h-[72px]">
                    <div class="w-12 h-12 rounded-lg bg-[#1a1a1e] border border-white/10 flex flex-col items-center justify-center shrink-0 shadow-inner group-hover:border-indigo-500/30 transition-colors">
                        <span class="text-[9px] text-gray-500 font-bold leading-none">
                            {pick.year}
                        </span>
                        <span class="text-[12px] text-white font-black leading-tight uppercase">
                            {pick.month}
                        </span>
                    </div>

                    <div class="flex-1 min-w-0 flex gap-3 items-center">
                        <img
                            src={pick.cover}
                            class="w-8 h-10 rounded object-cover shadow-sm"
                        />
                        <div class="min-w-0">
                            <h4 class="text-xs font-bold text-gray-200 truncate group-hover:text-indigo-300">
                                {pick.title}
                            </h4>
                            <p class="text-[9px] text-gray-600 uppercase font-bold">
                                Selecci칩n
                            </p>
                        </div>
                    </div>
                </div>
            ))
        }

        <div
            id="fade-overlay"
            class="absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-[#050505] to-transparent pointer-events-none"
        >
        </div>
    </div>

    {
        sortedPicks.length > 5 && (
            <div class="flex justify-center mt-2">
                <button
                    onclick="toggleMonthly()"
                    id="toggle-btn"
                    class="text-xs font-bold text-gray-500 hover:text-white flex items-center gap-2 bg-[#121215] px-4 py-1.5 rounded-full border border-white/5 hover:border-white/20 transition-all"
                >
                    <span>Ver historial</span>{" "}
                    <i class="fa-solid fa-chevron-down" />
                </button>
            </div>
        )
    }
</section>

<script is:inline>
    let isExpanded = false;
    function toggleMonthly() {
        const container = document.getElementById("monthly-container");
        const btn = document.getElementById("toggle-btn");
        const fade = document.getElementById("fade-overlay");

        if (!isExpanded) {
            container.style.maxHeight = container.scrollHeight + "px"; // Altura real
            btn.innerHTML = `<span>Cerrar</span> <i class="fa-solid fa-chevron-up"></i>`;
            fade.style.display = "none";
        } else {
            container.style.maxHeight = "160px"; // 2 filas aprox
            btn.innerHTML = `<span>Ver historial</span> <i class="fa-solid fa-chevron-down"></i>`;
            fade.style.display = "block";
        }
        isExpanded = !isExpanded;
    }
</script>
