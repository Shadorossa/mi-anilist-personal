---
const { works = [], chars = [] } = Astro.props;

// Mostrar solo los Ãºltimos 12
const visibleWorks = works.slice(0, 12);
const visibleChars = chars.slice(0, 12);
---

<section class="border-t border-white/5 pt-10 pb-4">
    
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold text-white flex items-center gap-2 opacity-90">
            <span id="hist-icon" class="text-indigo-500"><i class="fa-solid fa-calendar-days"></i></span>
            <span>Historial Mensual</span>
        </h2>

        <div class="bg-[#121215] p-1 rounded-full border border-white/5 flex relative w-24 h-8 shadow-inner">
            <div id="hist-bg" class="absolute top-1 left-1 bottom-1 w-[calc(50%-4px)] bg-white/10 rounded-full transition-transform duration-300 ease-out border border-white/5"></div>
            <button onclick="switchHistory('works')" id="btn-hist-works" class="relative z-10 w-1/2 h-full flex items-center justify-center text-white transition-colors">
                <i class="fa-solid fa-gamepad text-[10px]"></i>
            </button>
            <button onclick="switchHistory('chars')" id="btn-hist-chars" class="relative z-10 w-1/2 h-full flex items-center justify-center text-gray-600 hover:text-white transition-colors">
                <i class="fa-solid fa-mask text-[10px]"></i>
            </button>
        </div>
    </div>

    <div id="hist-works" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 animate-fade-in">
        {visibleWorks.map((pick) => (
            <div class="bg-[#121215] border border-white/5 rounded-lg p-2 group hover:bg-white/5 hover:border-white/10 transition-all duration-300 cursor-default h-full flex flex-col">
                
                <div class="flex gap-2 h-10 mb-2 shrink-0">
                    <div class="w-10 bg-[#0a0a0c] rounded border border-white/5 flex flex-col items-center justify-center shrink-0">
                        <span class="text-[8px] text-gray-500 font-bold leading-none mb-0.5">{pick.year}</span>
                        <span class="text-[9px] text-indigo-400 font-black leading-none tracking-wide">{pick.month}</span>
                    </div>
                    <div class="flex-1 relative rounded overflow-hidden shadow-sm">
                        <img src={pick.cover} class="absolute inset-0 w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" loading="lazy" />
                    </div>
                </div>

                <div class="flex-1 flex items-center justify-center px-0.5 min-h-[24px]">
                    <h4 class="text-[10px] font-bold text-gray-400 leading-tight text-center group-hover:text-white transition-colors line-clamp-2">
                        {pick.title}
                    </h4>
                </div>
            </div>
        ))}
        {visibleWorks.length === 0 && <div class="col-span-full py-8 text-center text-xs text-gray-600 italic">No hay obras registradas.</div>}
    </div>

    <div id="hist-chars" class="hidden grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 animate-fade-in">
        {visibleChars.map((pick) => (
            <div class="bg-[#121215] border border-white/5 rounded-lg p-2 group hover:bg-white/5 hover:border-white/10 transition-all duration-300 cursor-default h-full flex flex-col">
                
                <div class="flex gap-2 h-10 mb-2 shrink-0">
                    <div class="w-10 bg-[#0a0a0c] rounded border border-white/5 flex flex-col items-center justify-center shrink-0">
                        <span class="text-[8px] text-gray-500 font-bold leading-none mb-0.5">{pick.year}</span>
                        <span class="text-[9px] text-pink-400 font-black leading-none tracking-wide">{pick.month}</span>
                    </div>
                    <div class="flex-1 relative rounded overflow-hidden shadow-sm">
                        <img src={pick.cover} class="absolute inset-0 w-full h-full object-cover object-top opacity-80 group-hover:opacity-100 transition-opacity" loading="lazy" />
                    </div>
                </div>

                <div class="flex-1 flex items-center justify-center px-0.5 min-h-[24px]">
                    <h4 class="text-[10px] font-bold text-gray-400 leading-tight text-center group-hover:text-white transition-colors line-clamp-2">
                        {pick.title}
                    </h4>
                </div>
            </div>
        ))}
        {visibleChars.length === 0 && <div class="col-span-full py-8 text-center text-xs text-gray-600 italic">No hay personajes registrados.</div>}
    </div>

</section>

<script is:inline>
    window.switchHistory = (type) => {
        const wContainer = document.getElementById('hist-works');
        const cContainer = document.getElementById('hist-chars');
        const bg = document.getElementById('hist-bg');
        const btnW = document.getElementById('btn-hist-works');
        const btnC = document.getElementById('btn-hist-chars');
        const icon = document.getElementById('hist-icon');

        if (type === 'works') {
            wContainer.classList.remove('hidden'); wContainer.classList.add('grid');
            cContainer.classList.add('hidden'); cContainer.classList.remove('grid');

            bg.style.transform = 'translateX(0)';
            btnW.classList.add('text-white'); btnW.classList.remove('text-gray-600');
            btnC.classList.add('text-gray-600'); btnC.classList.remove('text-white');
            
            icon.innerHTML = '<i class="fa-solid fa-calendar-days"></i>';
            icon.className = 'text-indigo-500';
        } else {
            wContainer.classList.add('hidden'); wContainer.classList.remove('grid');
            cContainer.classList.remove('hidden'); cContainer.classList.add('grid');

            bg.style.transform = 'translateX(100%)';
            btnC.classList.add('text-white'); btnC.classList.remove('text-gray-600');
            btnW.classList.add('text-gray-600'); btnW.classList.remove('text-white');

            icon.innerHTML = '<i class="fa-solid fa-calendar-days"></i>';
            icon.className = 'text-pink-500';
        }
    }
</script>

<style>
    .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
</style>