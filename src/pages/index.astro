---
import { getCollection } from "astro:content";

// --- CONFIGURACIÓN Y DATOS ---
let profile = { username: "Admin", bio: "Explorador de mundos digitales." };
try {
	const config = await import("../content/config.json");
	profile = config.default || config;
} catch (e) {}

const bannerPath = "/img/profile/banner.png";
const avatarPath = "/img/profile/pic.png";

// Cargar Colecciones
const games = await getCollection("games").catch(() => []);
const anime = await getCollection("anime").catch(() => []);
const manga = await getCollection("manga").catch(() => []);

const allContent = [
	...games.map((i) => ({ ...i, type: "game" })),
	...anime.map((i) => ({ ...i, type: "anime" })),
	...manga.map((i) => ({ ...i, type: "manga" })),
];

// Ordenar por Puntuación para los favoritos (Top 10)
const favorites = allContent
	.filter((i) => i.data.score >= 9)
	.sort((a, b) => b.data.score - a.data.score)
	.slice(0, 10);

// --- DATOS MOCKUP (Edita esto a mano para cambiar Personajes o Timeline) ---
const monthlyPicks = [
	{
		month: "OCT",
		year: "2023",
		title: "Cyberpunk 2077",
		cover: "https://images.igdb.com/igdb/image/upload/t_cover_big/co2mjs.jpg",
	},
	{
		month: "NOV",
		year: "2023",
		title: "Pluto",
		cover: "https://s4.anilist.co/file/anilistcdn/media/anime/cover/large/bx140352-Rh4fC7Zz9g5C.jpg",
	},
	{
		month: "DIC",
		year: "2023",
		title: "Baldur's Gate 3",
		cover: "https://images.igdb.com/igdb/image/upload/t_cover_big/co670h.jpg",
	},
	{
		month: "ENE",
		year: "2024",
		title: "Frieren",
		cover: "https://s4.anilist.co/file/anilistcdn/media/anime/cover/large/bx154587-n1fmjvsLPF0p.jpg",
	},
];

const customCharacters = [
	{
		name: "Malenia",
		source: "Elden Ring",
		img: "https://i.pinimg.com/564x/a4/06/13/a40613869260cb269d0335e265c79ba8.jpg",
	},
	{
		name: "Guts",
		source: "Berserk",
		img: "https://i.pinimg.com/564x/31/85/3e/31853e6601d51a66072b22650c822369.jpg",
	},
	{
		name: "2B",
		source: "Nier: Automata",
		img: "https://i.pinimg.com/564x/44/2c/62/442c628df529e0617300cf9d0411a0a2.jpg",
	},
	{
		name: "Lucy",
		source: "Edgerunners",
		img: "https://i.pinimg.com/736x/88/2c/3f/882c3f156d9539d04838618f03c02640.jpg",
	},
	{
		name: "Kratos",
		source: "God of War",
		img: "https://i.pinimg.com/564x/e1/90/18/e19018420937a0928230713be51878d6.jpg",
	},
];
---

<html lang="es" class="dark">
	<head>
		<meta charset="UTF-8" />
		<title>{profile.username} | Colección</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
		/>
		<style>
			/* FONDO */
			body {
				background-color: #050505;
				color: #e4e4e7;
				/* Degradado radial sutil */
				background-image: radial-gradient(
					circle at 50% 0%,
					#1a1a20 0%,
					#050505 70%
				);
			}

			.glass {
				background: rgba(20, 20, 23, 0.7);
				backdrop-filter: blur(12px);
				border: 1px solid rgba(255, 255, 255, 0.05);
			}
			.hide-scroll::-webkit-scrollbar {
				display: none;
			}

			/* --- ESTILOS DEL ACORDEÓN --- */
			.accordion-container {
				display: flex; /* Flexbox para alinear ítems */
				justify-content: flex-start; /* Alineación a la izquierda */
				gap: 8px;
				width: 100%;
				overflow-x: auto; /* Scroll si hay muchos */
				padding-bottom: 10px; /* Espacio para scrollbar oculta */
			}
			/* Ocultar barra scroll en acordeón también */
			.accordion-container::-webkit-scrollbar {
				display: none;
			}

			.accordion-item {
				/* ESTADO REPOSO: Estrecho */
				width: 80px;
				height: 400px;
				flex-shrink: 0; /* NO encogerse */
				flex-grow: 0; /* NO estirarse para llenar hueco */

				position: relative;
				overflow: hidden;
				border-radius: 16px;
				border: 1px solid rgba(255, 255, 255, 0.1);
				transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
				filter: grayscale(100%) brightness(0.6); /* Apagado por defecto */
				background: #111;
			}

			/* ESTADO HOVER: Expandido */
			.accordion-item:hover {
				width: 320px; /* Ancho al abrirse */
				filter: grayscale(0) brightness(1);
				border-color: rgba(255, 255, 255, 0.4);
				box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
				z-index: 10;
			}

			.accordion-item img {
				width: 100%;
				height: 100%;
				object-fit: cover;
			}

			/* Texto Vertical */
			.vertical-text {
				writing-mode: vertical-rl;
				text-orientation: mixed;
				transform: rotate(180deg);
				white-space: nowrap;
			}
		</style>
	</head>
	<body
		class="font-sans min-h-screen pb-20 selection:bg-indigo-500/30 selection:text-white"
	>
		<header class="relative w-full mb-12">
			<div class="h-80 w-full overflow-hidden relative">
				<img
					src={bannerPath}
					onerror="this.src='https://placehold.co/1500x500/111/333?text=Banner'"
					class="w-full h-full object-cover opacity-50"
				/>
				<div
					class="absolute inset-0 bg-gradient-to-t from-[#050505] via-[#050505]/40 to-transparent"
				>
				</div>

				<a
					href="/admin"
					class="absolute top-6 right-6 glass px-4 py-2 rounded-full text-xs font-bold text-white hover:bg-white/10 transition border border-white/5 flex items-center gap-2 z-20"
				>
					<i class="fa-solid fa-gear"></i>
					<span>Admin</span>
				</a>
			</div>

			<div
				class="absolute -bottom-10 left-0 w-full px-4 md:px-12 flex flex-col md:flex-row items-end gap-6 z-10 max-w-7xl mx-auto"
			>
				<div class="relative group">
					<div
						class="absolute -inset-1 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full blur opacity-50 group-hover:opacity-100 transition duration-500"
					>
					</div>
					<img
						src={avatarPath}
						onerror="this.src='https://placehold.co/200?text=U'"
						class="relative w-32 h-32 md:w-40 md:h-40 rounded-full border-4 border-[#050505] object-cover bg-[#1a1a1e]"
					/>
				</div>
				<div class="mb-4 flex-1">
					<h1
						class="text-4xl md:text-5xl font-black text-white tracking-tighter drop-shadow-2xl"
					>
						{profile.username}
					</h1>
					<p
						class="text-gray-400 text-sm font-medium mt-1 inline-flex items-center gap-2 bg-black/40 px-3 py-1 rounded-full border border-white/5 backdrop-blur-md"
					>
						<span
							class="w-2 h-2 rounded-full bg-green-500 animate-pulse"
						></span>
						{profile.bio}
					</p>
				</div>

				<div
					class="hidden md:flex gap-8 mb-6 bg-[#0f0f12]/90 px-8 py-4 rounded-2xl border border-white/10 backdrop-blur-xl shadow-2xl"
				>
					<div class="text-center">
						<span class="block text-2xl font-black text-white"
							>{allContent.length}</span
						>
						<span
							class="text-[10px] text-gray-500 uppercase font-bold tracking-widest"
							>Total</span
						>
					</div>
					<div class="w-px bg-white/10"></div>
					<div class="text-center">
						<span class="block text-2xl font-black text-indigo-400"
							>{
								allContent.filter(
									(i) => i.data.status === "Jugando",
								).length
							}</span
						>
						<span
							class="text-[10px] text-gray-500 uppercase font-bold tracking-widest"
							>Jugando</span
						>
					</div>
					<div class="w-px bg-white/10"></div>
					<div class="text-center">
						<span class="block text-2xl font-black text-yellow-500"
							>{favorites.length}</span
						>
						<span
							class="text-[10px] text-gray-500 uppercase font-bold tracking-widest"
							>Top</span
						>
					</div>
				</div>
			</div>
		</header>

		<main class="max-w-7xl mx-auto px-4 md:px-8 space-y-16">
			<section>
				<div class="flex items-center justify-between mb-8">
					<h2
						class="text-2xl font-black text-white flex items-center gap-3 uppercase tracking-tight"
					>
						<span
							class="bg-yellow-500 text-black w-8 h-8 flex items-center justify-center rounded-lg shadow-lg shadow-yellow-500/20"
							><i class="fa-solid fa-crown"></i></span
						>
						Hall of Fame
					</h2>

					<div
						class="bg-[#1a1a1e] p-1.5 rounded-xl flex text-xs font-bold border border-white/10 shadow-inner"
					>
						<button
							onclick="switchFav('works', this)"
							class="fav-tab active px-5 py-2 rounded-lg bg-white text-black shadow-sm transition-all flex items-center gap-2"
						>
							<i class="fa-solid fa-layer-group"></i> Obras
						</button>
						<button
							onclick="switchFav('chars', this)"
							class="fav-tab px-5 py-2 rounded-lg text-gray-400 hover:text-white transition-all flex items-center gap-2"
						>
							<i class="fa-solid fa-users"></i> Personajes
						</button>
					</div>
				</div>

				<div id="fav-works" class="accordion-container">
					{
						favorites.map((item) => (
							<div class="accordion-item group cursor-pointer">
								<img src={item.data.cover} loading="lazy" />

								<div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-60" />

								<div class="absolute inset-0 flex items-center justify-center group-hover:opacity-0 transition-opacity duration-300">
									<span class="vertical-text text-white/40 font-black tracking-[0.2em] text-xs uppercase truncate h-[300px]">
										{item.data.title}
									</span>
								</div>

								<div class="absolute bottom-6 left-6 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-4 group-hover:translate-y-0 delay-75 min-w-[200px]">
									<h3 class="text-2xl font-black text-white leading-none uppercase italic drop-shadow-md line-clamp-2">
										{item.data.title}
									</h3>
									<div class="flex items-center gap-2 mt-3">
										<span class="bg-yellow-500 text-black text-xs font-black px-2 py-0.5 rounded">
											{item.data.score} / 10
										</span>
										<span class="text-gray-300 text-xs font-bold border border-white/20 px-2 py-0.5 rounded">
											{item.data.year}
										</span>
									</div>
								</div>
							</div>
						))
					}

					{
						favorites.length === 0 && (
							<div class="w-full h-64 border border-dashed border-white/10 rounded-2xl flex flex-col items-center justify-center text-gray-500">
								<i class="fa-regular fa-star text-4xl mb-4 opacity-50" />
								<p>No tienes obras con nota 9 o 10.</p>
							</div>
						)
					}
				</div>

				<div id="fav-chars" class="accordion-container hidden">
					{
						customCharacters.map((char) => (
							<div class="accordion-item group cursor-pointer">
								<img
									src={char.img}
									loading="lazy"
									style="object-position: top center;"
								/>
								<div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-black/90" />

								<div class="absolute inset-0 flex items-center justify-center group-hover:opacity-0 transition-opacity duration-300">
									<span class="vertical-text text-white/40 font-black tracking-[0.2em] text-xs uppercase truncate h-[300px]">
										{char.name}
									</span>
								</div>

								<div class="absolute bottom-6 left-6 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-4 group-hover:translate-y-0 delay-75 min-w-[200px]">
									<h3 class="text-3xl font-black text-white leading-none uppercase italic drop-shadow-lg">
										{char.name}
									</h3>
									<p class="text-indigo-400 text-sm font-bold mt-1 tracking-wider">
										{char.source}
									</p>
								</div>
							</div>
						))
					}
				</div>
			</section>

			<section>
				<h2
					class="text-xl font-bold text-white mb-6 flex items-center gap-3 opacity-90"
				>
					<i class="fa-regular fa-calendar-check text-indigo-500"></i> Favorito
					del Mes
				</h2>
				<div class="flex gap-4 overflow-x-auto hide-scroll pb-4">
					{
						monthlyPicks.map((pick) => (
							<div class="flex-shrink-0 group cursor-pointer">
								<div class="flex items-center gap-4 bg-[#121215] border border-white/5 pr-6 pl-2 py-2 rounded-full hover:bg-white/5 transition-all group-hover:border-indigo-500/30 group-hover:shadow-lg group-hover:shadow-indigo-500/10">
									<div class="w-12 h-12 rounded-full bg-[#1a1a1e] border border-white/5 flex flex-col items-center justify-center shrink-0 shadow-inner group-hover:scale-110 transition-transform duration-300 group-hover:border-indigo-500/50">
										<span class="text-[9px] text-gray-500 font-bold leading-none">
											{pick.year}
										</span>
										<span class="text-[11px] text-white font-black leading-tight">
											{pick.month}
										</span>
									</div>

									<div class="flex items-center gap-3">
										<img
											src={pick.cover}
											class="w-8 h-10 rounded object-cover opacity-80 group-hover:opacity-100 shadow-md"
										/>
										<div>
											<h4 class="text-sm font-bold text-gray-200 group-hover:text-indigo-400 transition-colors">
												{pick.title}
											</h4>
											<p class="text-[9px] text-gray-600 uppercase font-black tracking-widest">
												Top Pick
											</p>
										</div>
									</div>
								</div>
							</div>
						))
					}
				</div>
			</section>

			<section class="border-t border-white/5 pt-10">
				<div
					class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8"
				>
					<h2
						class="text-xl font-bold text-white opacity-80 flex items-center gap-2"
					>
						<i class="fa-solid fa-book-bookmark text-gray-600"></i> Biblioteca
					</h2>

					<nav
						class="flex gap-1 bg-[#121215] p-1.5 rounded-xl border border-white/5 w-fit overflow-x-auto"
					>
						<button
							onclick="filter('all', this)"
							class="grid-tab active px-5 py-2 rounded-lg text-xs font-bold bg-white/10 text-white shadow-sm transition-all whitespace-nowrap"
							>Todo</button
						>
						<button
							onclick="filter('game', this)"
							class="grid-tab px-5 py-2 rounded-lg text-xs font-bold text-gray-500 hover:text-gray-300 hover:bg-white/5 transition-all whitespace-nowrap"
							>Juegos</button
						>
						<button
							onclick="filter('anime', this)"
							class="grid-tab px-5 py-2 rounded-lg text-xs font-bold text-gray-500 hover:text-gray-300 hover:bg-white/5 transition-all whitespace-nowrap"
							>Anime</button
						>
						<button
							onclick="filter('manga', this)"
							class="grid-tab px-5 py-2 rounded-lg text-xs font-bold text-gray-500 hover:text-gray-300 hover:bg-white/5 transition-all whitespace-nowrap"
							>Manga</button
						>
					</nav>
				</div>

				<div
					id="grid"
					class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-7 gap-4 md:gap-6"
				>
					{
						allContent.map((item) => (
							<div
								class="relative aspect-[2/3] rounded-xl overflow-hidden cursor-pointer group bg-[#121215] ring-1 ring-white/5 shadow-sm hover:shadow-2xl hover:shadow-indigo-500/10 transition-all hover:-translate-y-1"
								data-type={item.type}
							>
								<img
									src={item.data.cover}
									loading="lazy"
									class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-70 group-hover:opacity-100"
								/>

								<div
									class={`absolute top-2 right-2 w-2 h-2 rounded-full shadow-lg ${item.data.status === "Jugando" ? "bg-green-500 shadow-green-500/50 animate-pulse" : item.data.status === "Completado" ? "bg-blue-500" : "bg-gray-500"}`}
								/>

								<div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4">
									<div>
										<h3 class="text-white text-xs font-bold leading-tight line-clamp-2">
											{item.data.title}
										</h3>
										<div class="flex items-center gap-2 text-[10px] text-gray-400 mt-1 font-bold">
											<span class="text-yellow-500">
												<i class="fa-solid fa-star" />{" "}
												{item.data.score}
											</span>
										</div>
									</div>
								</div>
							</div>
						))
					}
				</div>

				<div
					id="empty-state"
					class="hidden py-32 text-center text-gray-600"
				>
					<i class="fa-solid fa-ghost text-4xl mb-4 opacity-20"></i>
					<p>No se encontraron obras en esta categoría.</p>
				</div>
			</section>
		</main>

		<script is:inline>
			// --- LÓGICA DE FAVORITOS (SWITCHER) ---
			function switchFav(type, btn) {
				// 1. Resetear estilos botones
				document.querySelectorAll(".fav-tab").forEach((b) => {
					b.classList.remove("bg-white", "text-black"); // Estilo Activo
					b.classList.add("text-gray-400"); // Estilo Inactivo
				});
				// 2. Activar botón clickado
				btn.classList.add("bg-white", "text-black");
				btn.classList.remove("text-gray-400");

				// 3. Mostrar/Ocultar Contenedores
				const worksContainer = document.getElementById("fav-works");
				const charsContainer = document.getElementById("fav-chars");

				if (type === "works") {
					worksContainer.classList.remove("hidden");
					worksContainer.classList.add("flex"); // Asegurar flex para el acordeón
					charsContainer.classList.add("hidden");
					charsContainer.classList.remove("flex");
				} else {
					worksContainer.classList.add("hidden");
					worksContainer.classList.remove("flex");
					charsContainer.classList.remove("hidden");
					charsContainer.classList.add("flex");
				}
			}

			// --- LÓGICA DE FILTRO BIBLIOTECA ---
			function filter(cat, btn) {
				document.querySelectorAll(".grid-tab").forEach((b) => {
					b.className =
						"grid-tab px-5 py-2 rounded-lg text-xs font-bold text-gray-500 hover:text-gray-300 hover:bg-white/5 transition-all whitespace-nowrap";
				});
				btn.className =
					"grid-tab active px-5 py-2 rounded-lg text-xs font-bold bg-white/10 text-white shadow-sm transition-all whitespace-nowrap";

				const items = document.querySelectorAll("#grid > div");
				let count = 0;
				items.forEach((item) => {
					if (cat === "all" || item.dataset.type === cat) {
						item.style.display = "block";
						count++;
					} else {
						item.style.display = "none";
					}
				});
				document.getElementById("empty-state").style.display = count
					? "none"
					: "block";
			}
		</script>
	</body>
</html>
